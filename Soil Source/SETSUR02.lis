Silverfrost FTN95/x64 Ver 8.50.0  SETSUR02.FOR  Sun Oct 27 15:06:02 2019

Compiler used    [C:\Program Files (x86)\Silverfrost\FTN95\FTN95.EXE]
Salflibc path    [C:\Program Files (x86)\Silverfrost\FTN95\salflibc.dll]
Salflibc version [21.4.29.16]
Compiler options in effect:
    64;BINARY;CFPP;ERROR_NUMBERS;FIXED_FORMAT;FPP;IGNORE;LIST;
    LIST_INSERT_FILES;NO_BANNER;TABS;UNLIMITED_ERRORS;VS7;XREF;

   0001   CDT 09/10/2014 added CO2 as an environmental variable                                  AT 0
   0002   C     changed relative humidity to be input as a whole number and                      AT 11a
   0003   C     convert to fraction internally to make                                           AT 11a
   0004   C     the routine consistent with the hourly one.                                      AT 11a
   0005                                                                                          AT 11a
   0006   C**                                                                   **               AT 11a
   0007   C**  this routine taken from GLYCIM                                   **               AT 11a
   0008   C**  MSW1-  switch to indicate if daily wet bulb temperatures are     **               AT 11a
   0009   C**         available (=1 if YES).                                    **               AT 11a
   0010   C**                                                                   **               AT 11a
   0011   C**  MSW2-  switch to indicate if hourly wind is available (=1 if YES).**              AT 11a
   0012   C**  MSW3-  Daily rain intensities                                    **               AT 11a
   0013   C** cdt don't think these two variables (above) are needed  for hourly data            AT 11a
   0014   C**  MSW4-  Chemical concentrations in rain water                     **               AT 11a
   0015   C**  MSW5-  1 for furrow irrigation                                   **               AT 11a
   0016   C**  MSW6-  1 if relative humidity is available                       **               AT 11a
   0017   C**  MSW7-  1 if Daily CO2 Measurements are available                 **               AT 11a
   0018   C**                                                                   **               AT 11a
   0019   C**  BSOLAR-factor for changing solar radiation units. Equals         **               AT 11a
   0020   C**         radiation in J m-2 divided by radiation in units used in  **               AT 11a
   0021   C**         weather data file.                                        **               AT 11a
   0022   C**                                                                   **               AT 11a
   0023   C**  BTEMP- factor for changing temperature units. Equals change in   **               AT 11a
   0024   C**         temperature, in units used in weather data file, that is  **               AT 11a
   0025   C**         equivalent to a one oC change.                            **               AT 11a
   0026   C**                                                                   **               AT 11a
   0027   C**  ATEMP- factor for changing temperature units. Equals temperature **               AT 11a
   0028   C**         used in weather data file that is equivalent to zero oC.  **               AT 11a
   0029   C**                                                                   **               AT 11a
   0030   C**  ERAIN- factor for changing rain units. Equals rainfall in mm     **               AT 11a
   0031   C**         day-1 divided by rainfall in units used in weather data   **               AT 11a
   0032   C**         file.                                                     **               AT 11a
   0033   C**                                                                   **               AT 11a
   0034   C**  BWIND- factor for changing wind units. Equals windspeed in       **               AT 11a
   0035   C**         km hr-1 divided by windspeed in units used in weather     **               AT 11a
   0036   C**         data file.                                                **               AT 11a
   0037   C**                                                                   **               AT 11a
   0038   C**                                                                   **               AT 11a
   0039   C** CO2   -  If daily values are not available read average           **               AT 11a
   0040   C**                                                                   **               AT 11a
   0041   C**  WIND-  if windspeed is unavailable read in average value for     **               AT 11a
   0042   C**         site. windspeed at 2 meters (km hr-1).                    **               AT 11a
   0043   C**                                                                   **               AT 11a
   0044   C**  (File 1, Line 3 to EOF, free format)                             **               AT 11a
   0045   C**      (RH WIND, TWET and TDRY CO2 are optional)                    **               AT 11a
   0046   C**                                                                   **               AT 11a
   0047   C**  JDAY-  day of year- Julian Date.  Only used for management       **               AT 11a
   0048   C**         of the weather file. Program converts calendar date       **               AT 11a
   0049   C**         to a day of year relative to 3/1/1900                     **               AT 11a
   0050   C**                                                                   **               AT 11a
   0051   C**  RI-    daily solar radiation integral (J m-2).                   **               AT 11a
   0052   C**                                                                   **               AT 11a
   0053   C**  TMAX-  maximum air temperature during the day (oC).              **               AT 11a
   0054   C**                                                                   **               AT 11a
   0055   C**  TMIN-  minimum air temperature during the day (oC).              **               AT 11a
   0056   C**                                                                   **               AT 11a
   0057   C**  RAIN-  rainfall (or irrigation) (mm day-1).                      **               AT 11a
   0058   C**                                                                   **               AT 11a
   0059   C**  WIND-  windspeed at 2 meters (km hr-1).                          **               AT 11a
   0060   C**                                                                   **               AT 11a
   0061   C**  RH-    Relative Humidity, (%, i.e., 90.2)                        **               AT 11a
   0062   C**                                                                   **               AT 11a
   0063   C**  IRAV-  avg Rainfall intensity for the day, (mm/day, hr?)              **          AT 11a
   0064   C**                                                                   **               AT 11a
   0065   C**  TWET-  wet bulb temperature (oC).                                **               AT 11a
   0066   C**                                                                   **               AT 11a
   0067   C**  TDRY- dry bulb temperature corresponding to TWET (oC).           **               AT 11a
   0068   C**                                                                   **               AT 11a
   0069   C**  CO2  - CO2 concentration of the atmosphere ppm                   **               AT 11a
   0070   C**                                                                   **               AT 11a
   0071   C**  Daily values for radiation will be converted to watts m-2 as                      AT 11a
   0072   C**   soon as they are read in.                                                        AT 11a
   0073   C**                                                                   **               AT 11a
   0074         Subroutine SetSurfaceD()                                                         AT 11a
   0075         Include 'Public.ins'                                                             AT 11a
 1/0001   c  dt ToDo - simplyfy common blocks so only variables needed in plant model            AT 11a
 1/0002   c dt ToDo May 2016 added VarBW_old for debugging purposes can be removed later         AT 11a
 1/0003   c   will be transferred.                                                               AT 11a
 1/0004         Parameter (NumNPD=4000, NumElD=3500, NumBPD=600, NSeepD = 2,                     AT 11a
 1/0005        &           NumSPD= 30, NumSD =10, NDrainD=2,NumDR=30,                            AT 11a
 1/0006        &           NumGD = 3, NumPlD=100,                                                AT 11a
 1/0007        &           NMatD=15,MNorth=4,                                                    AT 11a
 1/0008        &           NumModD=20, MBandD=15,  NumSurfDatD=3+NumGD+NumSD)                    AT 11a
 1/0009                                                                                          AT 11a
 1/0010                                                                                          AT 11a
 1/0011         Double precision Time,Step,tNext,                                                AT 11a
 1/0012        &             dtOpt,dtMin,dMul1,dMul2,dtMx,tTDB,tFin,tatm                         AT 11a
 1/0013         Double precision  A1,B1,VRV,RES,RQI,RQ,QI,QQ,RQIDOT                              AT 11a
 1/0014         Double precision  ECNVRG, RCNVRG,ACNVRG                                          AT 11a
 1/0015         Double precision Starter, TimeStep                                               AT 11a
 1/0016                                                                                          AT 11a
 1/0017         Real BlkDn, FracSind, FracClay, FracOM, hCritS,hCritA                            AT 11a
 1/0018         Real nodeArea                                                                    AT 11a
 1/0019         Integer CodeW,CodeS,CodeT,CodeG,errPlant                                         AT 11a
 1/0020         Integer MaxItO, OutPutSoilNo, OutPutSoilYes                                      AT 11a
 1/0021         Logical*1 lOrt                                                                   AT 11a
 1/0022         Integer DailyOutput, HourlyOutput,RunFlag,                                       AT 11a
 1/0023        &  DailyWeather,HourlyWeather,ITIME, IDAWN, IDUSK,                                AT 11a
 1/0024        &  beginDay, sowingDay, endDay,year                                               AT 11a
 1/0025                                                                                          AT 11a
 1/0026         character WeatherFile*132, TimeFile*132, BiologyFile*132,                        AT 11a
 1/0027        &          ClimateFile*132, NitrogenFile*132, SoluteFile*132,                     AT 11a
 1/0028        &          SoilFile*132,                                                          AT 11a
 1/0029        &          ManagementFile*132,DripFile*132,                                       AT 11a
 1/0030        &          WaterFile*132, WaterBoundaryFile*132,                                  AT 11a
 1/0031        &          PlantGraphics*132,InitialsFile*132,  VarietyFile*132,                  AT 11a
 1/0032        &          NodeGraphics*132,ElemGraphics*132,                                     AT 11a
 1/0033        &          NodeGeomFile*132,                                                      AT 11a
 1/0034        &          GeometryFile*132,SurfaceGraphics*132,                                  AT 11a
 1/0035        &          FluxGraphics*132,MassBalanceFile*132,                                  AT 11a
 1/0036        &          MassBalanceFileOut*132,LeafGraphics*132,                               AT 11a
 1/0037        &          RunFile*132                                                            AT 11a
 1/0038         Common /grid_public/  NumNP, NumEl, IJ, KAT, MBand,Nmat,                         AT 11a
 1/0039        &        KX(NumElD,4),x(NumNPD), y(NumNPD), Area(NumElD),                         AT 11a
 1/0040        &        nodeArea(NumNPD)                                                         AT 11a
 1/0041         Common /nodal_public/ NumSol,NumG,ListN(NumNPD),ListNE(NumNPD),                  AT 11a
 1/0042        &       MatNumN(NumNPD),hNew(NumNPD),ThNew(NumNPD), Vx(NumNPD),                   AT 11a
 1/0043        &       Vz(NumNPD),Q(NumNPD), Conc(NumNPD,NumSD),                                 AT 11a
 1/0044        &       g(NumNPD,NumGD), Tmpr(NumNPD), Con(NumNPD),TcsXX(NumNPD),                 AT 11a
 1/0045        &       RO(NumNPD), hNew_org(NumNPD),QAct(NumNPD),ThetaAvail,                     AT 11a
 1/0046        &       ThetaFull, ThAvail(NumNPD),ThFull(NMAtD),  lOrt                           AT 11a
 1/0047         Common /elem_public/  MatNumE(NumElD),Sink(NumNPD),                              AT 11a
 1/0048        &       cSink(NumNPD,NumSD),gSink(NumNPD,NumGD),tSink(NumNPD),                    AT 11a
 1/0049        &       RTWT(NumNPD),RUTDEN(NumNPD),RMassM(NumNPD),RDenM(NumNPD),                 AT 11a
 1/0050        &       RMassY(NumNPD), RDenY(NumNPD)                                             AT 11a
 1/0051         Common /bound_public/ NumBP, NSurf, NVarBW,NVarBS,NVarBT,NVarBG,                 AT 11a
 1/0052        &       NumSurfDat, NSeep, NSP(NSeepD), NP(NSeepD,NumSPD),                        AT 11a
 1/0053        &       NDrain,NDR(NDrainD),ND(NDrainD,NumDR),                                    AT 11a
 1/0054        &       KXB(NumBPD),                                                              AT 11a
 1/0055        &       CodeW(NumNPD),CodeS(NumNPD),CodeT(NumNPD),CodeG(NumNPD),                  AT 11a
 1/0056        &       PCodeW(NumNPD),Width(NumBPD),                                             AT 11a
 1/0057        &       VarBW(NumBPD,3),VarBW_Old(NumBPD,3),                                      AT 11a
 1/0058        &       VarBS(NumBPD,NumSD),VarBT(NumBPD,4),                                      AT 11a
 1/0059        &       VarBG(NumBPD,NumGD,3),EO,Tpot                                             AT 11a
 1/0060         Common /time_public/tNext(NumModD),dtMx(4),Time,Step,dtOpt,                      AT 11a
 1/0061        &        dtMin, dMul1, dMul2,  tTDB(4), Tfin,tAtm, Tinit,                         AT 11a
 1/0062        &        lInput,Iter,DailyOutput,HourlyOutput,RunFlag,                            AT 11a
 1/0063        &          DailyWeather,HourlyWeather,                                            AT 11a
 1/0064        &          beginDay, sowingDay, endDay,                                           AT 11a
 1/0065        &          OutputSoilNo, OutPutSoilYes, Year,                                     AT 11a
 1/0066        &           iTime, iDawn, iDusk, dumpad, TimeStep                                 AT 11a
 1/0067         Common /module_public/  NumMod,Movers(4), NShoot                                 AT 11a
 1/0068         Common /error_public/errPlant                                                    AT 11a
 1/0069         Common /Solver_public/IAD(MBandD,NumNPD), IADN(NumNPD),                          AT 11a
 1/0070        &        IADD(NumNPD),A1(MBandD,NumNPD),B1(NumNPD),                               AT 11a
 1/0071        &        VRV(NumNPD),RES(NumNPD),RQI(NumNPD,MNorth),                              AT 11a
 1/0072        &        QQ(NumNPD), RQ(NumNPD),QI(NumNPD,MNorth), RQIDOT(MNorth)                 AT 11a
 1/0073                                                                                          AT 11a
 1/0074         Common /Initvar/ ECNVRG, RCNVRG, ACNVRG, MaxItO,EPSI_Heat,                       AT 11a
 1/0075        &                 EPSI_Solute, hCritS, hCritA                                     AT 11a
 1/0076                                                                                          AT 11a
 1/0077         Common /DataFilenames/ Starter, WeatherFile, TimeFile,                           AT 11a
 1/0078        &          BiologyFile,ClimateFile, NitrogenFile, SoluteFile,                     AT 11a
 1/0079        &          SoilFile,                                                              AT 11a
 1/0080        &          ManagementFile,DripFile,                                               AT 11a
 1/0081        &          WaterFile, WaterBoundaryFile,                                          AT 11a
 1/0082        &          PlantGraphics,InitialsFile,VarietyFile,                                AT 11a
 1/0083        &          NodeGraphics,ElemGraphics,NodeGeomFile,                                AT 11a
 1/0084        &          GeometryFile,SurfaceGraphics,                                          AT 11a
 1/0085        &          FluxGraphics, MassBalanceFile,MassBalanceFileOut,                      AT 11a
 1/0086        &          LeafGraphics,RunFile                                                   AT 11a
 1/0087                                                                                          AT 11a
 1/0088   c the following blocks are not passed to the crop model                                AT 11a
 1/0089         Common /Nodal_pub_Aux/ ROForInfil(NumBPD)                                        AT 11a
 1/0090                                                                                          AT 11a
 1/0091         Common /Materials/BlkDn(NMatD),FracSind(NMatD), FracClay(NMatD),                 AT 11a
 1/0092        &           FracOM(NMatD),TUpperLimit(NMatD), TLowerLimit(NMatD)                  AT 11a
   0076         Include 'Puplant.ins'                                                            AT 11a
 1/0001                                                                                          AT 11a
 1/0002         REAL*8 PCRL, PCRQ,PCRS,ET_demand,LCAI,COVER,CONVR                                AT 11a
 1/0003         Real*8 HourlyCarboUsed                                                           AT 11a
 1/0004         REAL*4 SHADE,HEIGHT,LAI,AWUPS,NitroDemand,NDemandError                           AT 11a
 1/0005         REAL LAREAT, MaxRootDepth, InitialRootCarbo                                      AT 11a
 1/0006         integer isGerminated, isEmerged                                                  AT 11a
 1/0007                                                                                          AT 11a
 1/0008   C includes variables shared with crop model                                            AT 11a
 1/0009         Common /ShootR/   PCRL,PCRQ,PCRS,HourlyCarboUsed, ET_demand,                     AT 11a
 1/0010        &                  LCAI,COVER,CONVR,                                              AT 11a
 1/0011        &                  MaxRootDepth,SHADE,HEIGHT,LAI,AWUPS,                           AT 11a
 1/0012        &                  NitroDemand,xBSTEM,yBSTEM,SGT,PSIM,                            AT 11a
 1/0013        &                  LAREAT,POPROW,ROWSP,ROWANG,PopArea,                            AT 11a
 1/0014        &                  CEC,EORSCS,AWUPSS,SOLRAD,                                      AT 11a
 1/0015        &                  Total_Eor,Total_Pcrs,sincrsink,PSILD,                          AT 11a
 1/0016        &                  OSMFAC,EOMULT,PSIL_,NDemandError,                              AT 11a
 1/0017        &                  CumulativeNDemandError,TotalRootWeight,                        AT 11a
 1/0018        &                  InitialRootCarbo,                                              AT 11a
 1/0019        &                  ConstI(2),constK(2), Cmin0(2),                                 AT 11a
 1/0020        &                  isGerminated, isEmerged                                        AT 11a
 1/0021                                                                                          AT 11a
 1/0022                                                                                          AT 11a
 1/0023   C includes variables only used inside 2dsoil                                           AT 11a
 1/0024         Common /shtR_public/ RVR(NumNPD), AWUP(NumELD),PSISM,PSILT,EOR,                  AT 11a
 1/0025        &                     YRL(NumNPD), RGCF(NumNPD),iFavRoot(NumNPD),                 AT 11a
 1/0026        &                     PSIS(NumNPD), TS(NumNPD),COND(NumNPD),                      AT 11a
 1/0027        &                     PDWR(NumNPD),                                               AT 11a
 1/0028        &                     DRL(NumNPD),WUPM(NumNPD),                                   AT 11a
 1/0029        &                     WUPN(NumNPD),WUPT(NumNPD),TPL,PPDRL(NumNPD),                AT 11a
 1/0030        &                     ADWR(NumNPD), AWR(NumNPD), ADRL(NumNPD),RTWL,               AT 11a
 1/0031        &                     RtMinWtPerUnitArea,Wl,Wa,Wr,Wb,ALPY,                        AT 11a
 1/0032        &                     WidthE(NumEld),HeightE(NumEld),                             AT 11a
 1/0033        &                  PILD,VMAX,vegsrc, potential_T,                                 AT 11a
 1/0034        &                   potential_T_EO,                                               AT 11a
 1/0035        &                  AWUPS_old, WUPMS, EORSCF,WUPDS, WUP2S,                         AT 11a
 1/0036        &                 WUP0S, DPSI02,SCF, PSIST,PROPAR,                                AT 11a
 1/0037        &                 VUP(NumNPD,2),FUP(NumNPD,2)                                     AT 11a
 1/0038   c      end                                                                             AT 11a
   0077         Include 'Puweath.ins'                                                            AT 11a
 1/0001         REAL IRAV,IR,LAMDAS,LAMDAC,LATUDE,Longitude                                      AT 11a
 1/0002         REAL WATACT,WATRAT,WATPOT                                                        AT 11a
 1/0003         Integer AutoIrrigateF                                                            AT 11a
 1/0004                                                                                          AT 11a
 1/0005         Common /Weath/ MSW1,MSW2,MSW3,MSW4,MSW5,MSW6,                                    AT 11a
 1/0006        &               MSW7,BSOLAR,ETCORR,                                               AT 11a
 1/0007        &               BTEMP,ATEMP,ERAIN,BWIND,BIR,WINDA,IRAV,JDAY,                      AT 11a
 1/0008        &               NCD,JDLAST, CLDFAC,DEL(24),RINT(24),GAMMA,RNS,                    AT 11a
 1/0009        &               RNC,RAIN,IR,WIND,CO2,TDUSK,TDUSKY,                                AT 11a
 1/0010        &               TWET,TDRY,CPREC(NumSD),TAIR(24),VPD(24),ROUGH,                    AT 11a
 1/0011        &               RADINT(24),WATTSM(24),DIFINT(24),                                 AT 11a
 1/0012        &               ROWINC(24),CLOUD,SHADOW(24),DIFWAT(24),                           AT 11a
 1/0013        &               DIRINT(24),WATACT,WATRAT,WATPOT,RNLU,                             AT 11a
 1/0014        &               NumF(40),NumFP,hFur(40),QF,IFUR,GAIR(NumGD),PG,                   AT 11a
 1/0015        &               LATUDE,Longitude, Altitude, RI,PAR(24),                           AT 11a
 1/0016        &               PARINT(24),daylng,AutoIrrigAmt,                                   AT 11a
 1/0017        &               AutoIrrigateF                                                     AT 11a
   0078         Parameter (PERIOD =1./24.)                                                       AT 11a
   0079         integer jday, DayofYear,CurYear, ModNum,ThisYear                                 AT 11a
   0080         Common /weather/ il,im,isol,ModNum                                               AT 11a
   0081                                                                                          AT 11a
   0082         double precision St,t                                                            AT 11a
   0083         character*10 date                                                                AT 11a
   0084         Dimension CLIMAT(20),SDERP(9),SINALT(24),SINAZI(24),HRANG(24),                   AT 11a
   0085        &          SARANG(24),                                                            AT 11a
   0086        &           SOLALT(24),SOLAZI(24)                                                 AT 11a
   0087         Dimension xS(NumBPD),iS(NumBPD),kS(NumBPD)                                       AT 11a
   0088         Data SDERP/0.3964E-0,0.3631E1,0.3838E-1,0.7659E-1,0.0000E0,                      AT 11a
   0089        & -0.2297E2,-0.3885E0,-0.1587E-0,-0.1021E-1/,PI /3.1415926/,                      AT 11a
   0090        &  TPI /6.2831852/,DEGRAD/0.017453293/,IPERD/24/                                  AT 11a
   0091   CYAP                                                                                   AT 11a
D:\2DSOIL_Grape\Soil Source\SETSUR02.FOR(90) : warning 1226 - A REAL constant has been truncated with possible loss of precision - maybe a KIND is required 
D:\2DSOIL_Grape\Soil Source\SETSUR02.FOR(90) : warning 1226 - A REAL constant has been truncated with possible loss of precision - maybe a KIND is required 
   0092         If(NSurf.eq.0) then                                                              AT 11a
   0093             RowSP=1.                                                                     AT 11a
   0094             height=0.                                                                    AT 11a
   0095            endif                                                                         AT 11a
   0096   CYAPEND                                                                                AT 11f
   0097         t=Time                                                                           AT 11f
   0098                                                                                          AT 11f
   0099         St=0.1D0*Step                                                                    AT 11f
   0100         If (lInput.eq.0) goto 11                                                         AT 11f
   0101         NumMod=NumMod+1                                                                  AT 182
   0102         ModNum=NumMod                                                                    AT 182
   0103         tNext(ModNum) = time                                                             AT 182
   0104                                                                                          AT 182
   0105   C                                                                                      AT 182
   0106   C  First and last days                                                                 AT 182
   0107   C                                                                                      AT 182
   0108         JDFRST=idint(t+St)                                                               AT 182
   0109         JDLAST=idint(tFin+St)                                                            AT 1d8
   0110   c                                                                                      AT 1d8
   0111         im=160                                                                           AT 1d8
   0112         il=0                                                                             AT 1d8
   0113                                                                                          AT 1d8
   0114   C   IS IT CLIMATE OR WEATHER FOLDER FILE                                               AT 1d8
   0115         Open (5,file=ClimateFile,status='old',ERR=10)                                    AT 1d8
   0116   C                                                                                      AT 286
   0117   C  Read descriptors and conversion constants for weather data\                         AT 286
   0118   C                                                                                      AT 286
   0119         im=im+1                                                                          AT 286
   0120         il=il+1                                                                          AT 286
   0121         Read (5,*,ERR=10)                                                                AT 286
   0122         im=im+1                                                                          AT 2e9
   0123         il=il+1                                                                          AT 2e9
   0124         Read (5,*,ERR=10)                                                                AT 2e9
   0125         im=im+1                                                                          AT 34c
   0126         il=il+1                                                                          AT 34c
   0127         Read (5,*,ERR=10) LATUDE                                                         AT 34c
   0128         im=im+1                                                                          AT 3ca
   0129         il=il+1                                                                          AT 3ca
   0130         Read (5,*,ERR=10)                                                                AT 3ca
   0131         im=im+1                                                                          AT 42d
   0132         il=il+1                                                                          AT 42d
   0133         Read (5,*,ERR=10) MSW1,MSW2,MSW3,MSW4,MSW5,MSW6,MSW7                             AT 42d
   0134         im=im+1                                                                          AT 54d
   0135         il=il+1                                                                          AT 54d
   0136         Read (5,*,ERR=10)                                                                AT 54d
   0137         im=im+1                                                                          AT 5b0
   0138         il=il+1                                                                          AT 5b0
   0139         Read (5,*,ERR=10)                                                                AT 5b0
   0140         im=im+1                                                                          AT 613
   0141         il=il+1                                                                          AT 613
   0142         Read (5,*,ERR=10) BSOLAR,BTEMP,ATEMP,ERAIN,BWIND,BIR                             AT 613
   0143         ISOL=NumSol*Movers(2)                                                            AT 7a6
   0144   c      the four basic variables are Daily wind, rain intensity daily concentration and co2      AT 7a6
   0145         NCD=4-MSW2-MSW3+ISOL+(NumG+1)*Movers(4)-MSW7                                     AT 7a6
   0146         im=im+1                                                                          AT 7a6
   0147         il=il+1                                                                          AT 7a6
   0148         Read (5,*,ERR=10)                                                                AT 7a6
   0149         im=im+1                                                                          AT 809
   0150         il=il+1                                                                          AT 809
   0151         Read (5,*,ERR=10)                                                                AT 809
   0152         im=im+1                                                                          AT 86c
   0153         il=il+1                                                                          AT 86c
   0154         Read(5,*,ERR=10) (CLIMAT(i),i=1,NCD)                                             AT 86c
   0155         IF(MSW2.eq.0) WINDA=CLIMAT(1)                                                    AT 925
   0156         IF(MSW3.eq.0) IRAV =CLIMAT(2-MSW2-MSW3)                                          AT 9d1
   0157         IF(MSW4.eq.1.AND.NumSol.gt.0) then                                               AT 9d1
   0158           Do i=1,NumSol                                                                  AT 9d1
   0159             CPREC(i)=CLIMAT(2-MSW2-MSW3+i)                                               AT 9ff
   0160           Enddo                                                                          AT a3d
   0161         Endif                                                                            AT ac6
   0162         If(NumG.ne.0) then                                                               AT ac6
   0163           PG=CLIMAT(3-MSW2-MSW3+ISOL)                                                    AT ac6
   0164           Do i=1,NumG                                                                    AT ac6
   0165             GAIR(i)=CLIMAT(3-MSW2-MSW3+ISOL+i)                                           AT aef
   0166           Enddo                                                                          AT b3b
   0167         Endif                                                                            AT b93
   0168         IF(MSW7.eq.0) then                                                               AT b93
   0169            CO2=CLIMAT(NCD) ! last one is always co2                                      AT b93
   0170          Endif                                                                           AT b93
   0171         close(5)                                                                         AT b93
   0172   C                                                                                      AT c59
   0173   C Total number of weather data                                                         AT c59
   0174   C                                                                                      AT c59
   0175         NCD=4+2*MSW1+MSW2+MSW3+ISOL*MSW4+MSW6+MSW7                                       AT c59
   0176   C                                                                                      AT c59
   0177   C     Nodal numbers of furrow nodes                                                    AT c59
   0178   C                                                                                      AT c59
   0179         im1=im                                                                           AT c59
   0180         il1=il                                                                           AT c59
   0181         im=180                                                                           AT c59
   0182         il=0                                                                             AT c59
   0183         If(MSW5.gt.0) then                                                               AT c59
   0184           Open(6,file='Furnod.dat',status='old',ERR=10)                                  AT c59
   0185           im=im+1                                                                        AT cff
   0186           il=il+1                                                                        AT cff
   0187           Read(6,*,ERR=10)                                                               AT cff
   0188           im=im+1                                                                        AT d62
   0189           il=il+1                                                                        AT d62
   0190           Read(6,*,ERR=10)                                                               AT d62
   0191           im=im+1                                                                        AT dc5
   0192           il=il+1                                                                        AT dc5
   0193           Read(6,*,ERR=10) NumFP                                                         AT dc5
   0194           im=im+1                                                                        AT e43
   0195           il=il+1                                                                        AT e43
   0196           Read(6,*,ERR=10)                                                               AT e43
   0197           im=im+1                                                                        AT ea6
   0198           il=il+1                                                                        AT ea6
   0199           Read(6,*,ERR=10) (NumF(i),i=1,NumFP)                                           AT ea6
   0200           im=im+1                                                                        AT f8e
   0201           il=il+1                                                                        AT f8e
   0202           Read(6,*,ERR=10)                                                               AT f8e
   0203           im=im+1                                                                        AT ff1
   0204           il=il+1                                                                        AT ff1
   0205           Read(6,*,ERR=10) (hFur(i),i=1,NumFP)                                           AT ff1
   0206           IFUR=0                                                                         AT 10eb
   0207         Endif                                                                            AT 10eb
   0208         im=im1                                                                           AT 10eb
   0209         il=il1                                                                           AT 10eb
   0210   C                                                                                      AT 10eb
   0211   C FIND CORRECT DAY IN WEATHER FILE                                                     AT 10eb
   0212   C                                                                                      AT 10eb
   0213         Open (5,file=WeatherFile,status='old',ERR=10)                                    AT 10eb
   0214         im=im+1                                                                          AT 1199
   0215         il=il+1                                                                          AT 1199
   0216         Read (5,*,ERR=10)                                                                AT 1199
   0217         im=im+1                                                                          AT 11fc
   0218         il=il+1                                                                          AT 11fc
   0219         Read (5,*,ERR=10)                                                                AT 11fc
   0220   1111  il=il+1                                                                          AT 1233
   0221         Read (5,*,ERR=10) iDum, date                                                     AT 124c
   0222         MDAY=julday(date)                                                                AT 12b2
   0223   cdt changed from LE to LT since jday was always gt. time                               AT 12cd
   0224         If (MDAY.LT.JDFRST) GO TO 1111                                                   AT 12cd
   0225   C                                                                                      AT 1366
   0226   C   CALCULATE A CLOUD COVER FACTOR FOR THIS LATITUDE                                   AT 1366
   0227   C                                                                                      AT 1366
   0228         If (LATUDE.LE.25.0) THEN                                                         AT 1366
   0229             CLDFAC = 0.45 - (LATUDE*0.004)                                               AT 1366
   0230         Else                                                                             AT 1366
   0231             CLDFAC = 0.30 + (LATUDE*0.002)                                               AT 1366
   0232         Endif                                                                            AT 1366
   0233   c                                                                                      AT 1366
   0234   c..................... Routine calculations                                            AT 1366
   0235   c..................... Calculations made daily                                         AT 1366
   0236      11 If(lInput.eq.1.OR.idint(time+St).eq.JDAY+1) then                                 AT 1366
   0237   c                                                                                      AT 13b7
   0238   c ZEROING DAILY ARRAYS                                                                 AT 13b7
   0239   c                                                                                      AT 13b7
   0240           Do i=1,24                                                                      AT 13b7
   0241             RINT(i)=0.                                                                   AT 13df
   0242             RADINT(i)=0.                                                                 AT 1409
   0243             WATTSM(i)=0.                                                                 AT 1433
   0244           Enddo                                                                          AT 1455
   0245   c                                                                                      AT 1486
   0246   c Read meteodata                                                                       AT 1486
   0247   c                                                                                      AT 1486
   0248           il=il-1                                                                        AT 1486
   0249           BACKSPACE(5)                                                                   AT 1486
   0250           il=il+1                                                                        AT 14be
   0251           Read(5,*,ERR=10) JDum,date,(CLIMAT(i),i=1,NCD)                                 AT 14be
   0252              JDAY=Julday(date)                                                           AT 158c
   0253   c    SInce some routines need the day of the calendar year we need a variable to hold this AT 15ae
   0254   C    since the julian day is referenced to a time longer in the past                   AT 15ae
   0255           ThisYear=CurYear(date)                                                         AT 15ae
   0256           write (date,'("01/01/",i4.4)') ThisYear                                        AT 15c9
   0257           DayOfYear=JDAY-julday(date)                                                    AT 162d
   0258   C                                                                                      AT 1659
   0259   C   ADJUST UNITS FOR WEATHER DATA                                                      AT 1659
   0260   C                                                                                      AT 1659
   0261   c                                                                                      AT 1659
   0262           RI = CLIMAT(1)*BSOLAR                                                          AT 1659
   0263           TMAX = (CLIMAT(2) - ATEMP)/BTEMP                                               AT 1677
   0264           TMIN = (CLIMAT(3) - ATEMP)/BTEMP                                               AT 169f
   0265   c   dt have to fix this later as model cannot handle freezing temperatures             AT 16c7
   0266           TMIN=max(TMIN,3.0)                                                             AT 16c7
   0267           RAIN = CLIMAT(4)*ERAIN                                                         AT 16df
   0268                                                                                          AT 170e
   0269                                                                                          AT 170e
   0270   c        If (rain.gt.0) then                                                           AT 170e
   0271   c         do ii=1,NumBp                                                                AT 170e
   0272   c           n=kxb(ii)                                                                  AT 170e
   0273   c           If (abs(codew(ii)).eq.4) then                                              AT 170e
   0274   c             hnew(n)=-1.0e3/(1+0.04*1.0e3)                                            AT 170e
   0275   c            EndIf                                                                     AT 170e
   0276   c          enddo                                                                       AT 170e
   0277   c         Endif                                                                        AT 170e
   0278                                                                                          AT 170e
   0279                                                                                          AT 170e
   0280                                                                                          AT 170e
   0281                                                                                          AT 170e
   0282                                                                                          AT 170e
   0283           If (MSW2.GT.0) then                                                            AT 170e
   0284             WIND = CLIMAT(5)*BWIND                                                       AT 170e
   0285           Else                                                                           AT 1738
   0286             WIND=WINDA*BWIND                                                             AT 18a7
   0287           Endif                                                                          AT 18a7
   0288           If (MSW1.GT.0) then                                                            AT 18a7
   0289             TWET = (CLIMAT(5+MSW2) - ATEMP)/BTEMP                                        AT 18a7
   0290             TDRY = (CLIMAT(6+MSW2) - ATEMP)/BTEMP                                        AT 18a7
   0291           Endif                                                                          AT 18a7
   0292           If (MSW3.GT.0) then                                                            AT 18a7
   0293             IR=CLIMAT(4+MSW2+2*MSW1)*BIR                                                 AT 18a7
   0294           Else                                                                           AT 18a7
   0295             IR=IRAV*BIR                                                                  AT 18a7
   0296           Endif                                                                          AT 18a7
   0297           If (MSW4.GT.0.AND.NumSol.ne.0) then                                            AT 18a7
   0298             Do i=1,NumSol                                                                AT 18a7
   0299               CPREC(i)=CLIMAT(4+MSW2+2*MSW1+MSW3+i)                                      AT 18cf
   0300             Enddo                                                                        AT 191b
   0301           Endif                                                                          AT 19dc
   0302           AutoIrrigAmt=IR   ! used in AutoIrrigation if carried out.                     AT 19dc
   0303   CDT                                                                                    AT 19dc
   0304                                                                                          AT 19dc
   0305         If(MSW6.gt.0) then                                                               AT 19dc
   0306   c        Rel_Humid=Climat(4+2*MSW1+MSW2+MSW3+ISOL+MSW6)                                AT 19dc
   0307            Rel_Humid=min(Climat(4+2*MSW1+MSW2+MSW3+ISOL*MSW4+MSW6)                       AT 19dc
   0308        &     /100.0,0.98)                                                                AT 19dc
   0309             Rel_Humid=max(0.0,Rel_Humid)                                                 AT 19dc
   0310   c         Rel_Humid=CLIMAT(5)                                                          AT 19f4
   0311          endif                                                                           AT 19f4
   0312         If(MSW7.gt.0) then                                                               AT 1a99
   0313             CO2=Climat(4+2*MSW1+MSW2+MSW3+ISOL*MSW4+MSW6+MSW7)                           AT 1a99
   0314          EndIf                                                                           AT 1a99
   0315   Cdt                                                                                    AT 1a99
   0316   c......................... Radiation submodel                                          AT 1a99
   0317   C                                                                                      AT 1a99
   0318   C  CALCULATE SOLAR DECLINATION                                                         AT 1a99
   0319   C                                                                                      AT 1a99
   0320           XLAT = LATUDE*DEGRAD                                                           AT 1a99
   0321           DEC = SDERP(1)                                                                 AT 1a99
   0322           Do I = 2,5                                                                     AT 1aac
   0323             N = I - 1                                                                    AT 1ac0
   0324             J = I + 4                                                                    AT 1ad3
   0325             D11 = N*0.01721*DayOfYear                                                    AT 1ae4
   0326             DEC = DEC + SDERP(I)*SIN(D11) + SDERP(J)*COS(D11)                            AT 1b11
   0327           Enddo                                                                          AT 1b7d
   0328           DEC = DEC*DEGRAD                                                               AT 1b95
   0329   C                                                                                      AT 1bb2
   0330   C  CALCULATE SOME PARTS OF THE SOLAR RADIATION EQUATIONS THAT                          AT 1bb2
   0331   C         OCCUR REPEATEDLY LATER                                                       AT 1bb2
   0332   C                                                                                      AT 1bb2
   0333           D12 = SIN(XLAT)*SIN(DEC)                                                       AT 1bb2
   0334           D13 = COS(XLAT)*COS(DEC)                                                       AT 1bf5
   0335           D14 = D12 + D13                                                                AT 1c38
   0336   C                                                                                      AT 1c47
   0337   C  CALCULATE DAYLENGTH                                                                 AT 1c47
   0338   C                                                                                      AT 1c47
   0339           DAYLNG = ACOS((-0.014544 - D12)/D13)*7.6394                                    AT 1c47
   0340   C       7.6394 = 180/3.1416/360*24*2                                                   AT 1c86
   0341   C                                                                                      AT 1c86
   0342   C  CALCULATE SOLAR RADIATION INCIDENT ON TOP OF THE EARTH'S                            AT 1c86
   0343   C         ATMOSPHERE AT SOLAR NOON                                                     AT 1c86
   0344   C                                                                                      AT 1c86
   0345           RADVEC = 1 + (0.01674*SIN((DayOfYear - 93.5)*0.9863*DEGRAD))                   AT 1c86
   0346           WATATM = 1325.4*D14/(RADVEC*RADVEC)                                            AT 1cee
   0347   C                                                                                      AT 1d1a
   0348   C  CALCULATE AN ATMOSPHERIC TRANSMISSION COEFFICIENT FOR THIS                          AT 1d1a
   0349   C         LATITUDE AND TIME OF YEAR. ***                                               AT 1d1a
   0350   C                                                                                      AT 1d1a
   0351           If (DayOfYear.LT.145) then                                                     AT 1d1a
   0352             ATRANS = 0.68 + ((5.25E-5*LATUDE) - 0.1E-3)*(145 - DayOfYear)                AT 1d26
   0353           Else If (DayOfYear.LE.237) then                                                AT 1d80
   0354             ATRANS = 0.68                                                                AT 1d91
   0355           Else                                                                           AT 1da9
   0356             If (LATUDE.LE.30.0) then                                                     AT 1e27
   0357               D15 = (LATUDE*5.5E-5) - 0.1E-3                                             AT 1e27
   0358             Else                                                                         AT 1e27
   0359               D15 = 0.65E-3 + (LATUDE*3.0E-5)                                            AT 1e27
   0360             Endif                                                                        AT 1e27
   0361             ATRANS = 0.68 + D15*(DayOfYear - 237)                                        AT 1e27
   0362           Endif                                                                          AT 1e5b
   0363   C                                                                                      AT 1e5b
   0364   C  CALCULATE POTENTIAL DIRECT + DIfFUSE RADIATION INCIDENT ON                          AT 1e5b
   0365   C         CROP AT SOLAR NOON                                                           AT 1e5b
   0366   C                                                                                      AT 1e5b
   0367           WATPOT = WATATM*0.5*(0.93 - (0.02/D14) + ATRANS**(1/D14))                      AT 1e5b
   0368   C                                                                                      AT 2046
   0369   C  CALCULATE ACTUAL RADIATION INCIDENT ON CROP AT SOLAR NOON                           AT 2046
   0370   C  GIVEN DAILY INTEGRAL AND ASSUMING RADIATION FLUX DENSITY                            AT 2046
   0371   C  VARIES AS A HALF SINE WAVE OVER THE PHOTOPERIOD                                     AT 2046
   0372   C                                                                                      AT 2046
   0373           WATACT = RI*4.363E-4/DAYLNG                                                    AT 2046
   0374   C       4.363E-4 = 3.1416/3600/2                                                       AT 2046
   0375   C                                                                                      AT 2046
   0376   C  CALCULATE CLOUD COVER. ***                                                          AT 2046
   0377   C                                                                                      AT 2046
   0378           WATRAT = WATACT/WATPOT                                                         AT 2046
   0379           If (WATRAT.GE.1.0) then                                                        AT 2046
   0380             CLOUD = 0.0                                                                  AT 2046
   0381           Else                                                                           AT 2046
   0382             CLOUD =(CLDFAC - SQRT((CLDFAC*CLDFAC) + (1.52*(1 - WATRAT))))                AT 2046
   0383        &   /(-0.76)                                                                      AT 2046
   0384   C        1.52 = 4*0.38                                                                 AT 2046
   0385   C        0.76 = 2*0.38                                                                 AT 2046
   0386             If (CLOUD.GE.1.0) CLOUD = 1.0                                                AT 2046
   0387           Endif                                                                          AT 2046
   0388   C                                                                                      AT 2046
   0389   C       DUSK AND DAWN                                                                  AT 2046
   0390   C                                                                                      AT 2046
   0391           DAWN = 12.0 - (DAYLNG/2.0)                                                     AT 2046
   0392           DUSK = 12.0 + (DAYLNG/2.0)                                                     AT 2046
   0393   C                                                                                      AT 2046
   0394   C  CALCULATE TOTAL RADIATION INCIDENT ON THE CROP AT EACH TIME                         AT 2046
   0395   C                                                                                      AT 2046
   0396   C  DIVIDE PHOTOPERIOD INTO IPERD EQUAL INCREMENTS AND CALCULATE                        AT 2046
   0397   C  HOUR ANGLES BETWEEN THE MIDPOINTS AND SOLAR NOON                                    AT 2046
   0398   C                                                                                      AT 2046
   0399           IHPERD = IPERD/2                                                               AT 2046
   0400           Do 20, J = 1,IHPERD                                                            AT 2061
   0401             HRANG(J) = PI/12.0*(12 - J + 0.5)                                            AT 2080
   0402    20     HRANG(IPERD - J + 1) = HRANG(J)                                                AT 20d0
   0403           DDIf = DAYLNG - (2.0*IfIX(DAYLNG/2))                                           AT 218f
   0404           IUP = 13 - IfIX(DAYLNG/2)                                                      AT 218f
   0405           IDN = 12 + (13 - IUP)                                                          AT 218f
   0406           If (.NOT.((DDIf.GT.0.0).OR.(DDIf.LT.0.0)))then                                 AT 21a2
   0407             IDAWN = IUP                                                                  AT 21f3
   0408             IDUSK = IDN                                                                  AT 21f3
   0409           Else                                                                           AT 21f3
   0410             IDAWN = IUP - 1                                                              AT 21f3
   0411             IDUSK = IDN + 1                                                              AT 220b
   0412           ENDIf                                                                          AT 221e
   0413   C                                                                                      AT 221e
   0414   C  CALCULATE TOTAL RADIATION INCIDENT ON THE CROP AT EACH TIME                         AT 221e
   0415   C                                                                                      AT 221e
   0416           Do I = 1,IPERD                                                                 AT 221e
   0417             TIMH = I - 0.5                                                               AT 2250
   0418             WATTSM(I) = 0.0                                                              AT 227f
   0419             If(I.GE.IUP.AND.I.LE.IDN)                                                    AT 2299
   0420        &      WATTSM(I) = WATACT*SIN(PI*(TIMH - DAWN)/DAYLNG)                            AT 2299
   0421           Enddo                                                                          AT 2340
   0422           If ((DDIf.GT.0.0).OR.(DDIf.LT.0.0)) then                                       AT 235b
   0423             TEND = (1 - COS((PI/DAYLNG)*(DDIf/2)))                                       AT 23a5
   0424              WATTSM(IDAWN) = TEND*RI*1.389E-4                                            AT 2493
   0425   C          1.389E-4 = 1/2)/3600                                                        AT 2493
   0426              WATTSM(IDUSK) = WATTSM(IDAWN)                                               AT 2493
   0427           ENDIf                                                                          AT 2493
   0428   c..................... Temperature and vapour pressure submodel                        AT 2493
   0429   C                                                                                      AT 2493
   0430   C  READ NEXT DAY'S DATA FROM WEATHER FILE ***                                          AT 2493
   0431   C                                                                                      AT 2493
   0432           il=il+1                                                                        AT 2493
   0433           Read (5,*,ERR=10) MDAY, date,(CLIMAT(i),i=1,NCD)                               AT 2493
   0434   c       Minimum tomorrow temperature                                                   AT 256c
   0435           MDAY=Julday(date)                                                              AT 256c
   0436           If (MDAY.LT.JDLAST) then                                                       AT 259b
   0437             TMINT = (CLIMAT(3) - ATEMP)/BTEMP                                            AT 259b
   0438           Else                                                                           AT 25cf
   0439             TMINT = TMIN                                                                 AT 25cf
   0440           ENDIf                                                                          AT 25e3
   0441   C                                                                                      AT 25fb
   0442   C  YESTERDAY DUSK TEMPERATURE                                                          AT 25fb
   0443   C                                                                                      AT 25fb
   0444           If (lInput.GT.0) then                                                          AT 25fb
   0445             TDUSKY = (TMAX + TMIN)/2.0                                                   AT 25fb
   0446           Else                                                                           AT 262e
   0447             TDUSKY = TDUSK                                                               AT 2663
   0448           Endif                                                                          AT 2663
   0449   C                                                                                      AT 2663
   0450   C  CALCULATE THE TIME AFTER DAWN IN HOURS WHEN MAXIMUM                                 AT 2663
   0451   C  TEMPERATURE IS REACHED                                                              AT 2663
   0452   C                                                                                      AT 2663
   0453           D20 = 0.0945 - (WATACT*8.06E-5) + (TMAX*6.77E-4)                               AT 2663
   0454           D21 = TMAX/D20/WATACT                                                          AT 268e
   0455           If (D21.GE.1.0) D21 = 1.0                                                      AT 26b1
   0456           TMAXHR = DAYLNG/PI*(PI - (ASIN(D21)))                                          AT 26f6
   0457   C                                                                                      AT 272a
   0458   C  CALCULATE SOME PARTS OF THE TEMPERATURE EQUATIONS THAT OCCUR                        AT 272a
   0459   C  REPEATEDLY LATER                                                                    AT 272a
   0460   C                                                                                      AT 272a
   0461           D22 = ((TMAX - TMIN)/2.0)                                                      AT 272a
   0462           D23 = (PI/TMAXHR)                                                              AT 2751
   0463           D24 = 1.5*PI                                                                   AT 2769
   0464   C                                                                                      AT 27e1
   0465   C  CALCULATE AIR TEMPERATURE AT DUSK                                                   AT 27e1
   0466   C                                                                                      AT 27e1
   0467           TDUSK = (D22*(1.0 + SIN((D23*DAYLNG + D24)))) + TMIN                           AT 27e1
   0468   C                                                                                      AT 27e1
   0469   C  CALCULATE SOME ADDITIONAL PARTS OF THE TEMPERATURE EQUATIONS                        AT 27e1
   0470   C  THAT OCCUR REPEATEDLY LATER                                                         AT 27e1
   0471   C                                                                                      AT 27e1
   0472           XTEMP = 5.0                                                                    AT 27e1
   0473           If (TMIN.LT.TDUSKY) then                                                       AT 283c
   0474             D25 = TDUSKY - TMIN + XTEMP                                                  AT 283c
   0475             D26 = ALOG(D25/XTEMP)/(2.0*DAWN)                                             AT 283c
   0476           Else                                                                           AT 2876
   0477             D27 = (TMIN - TDUSKY)/(2.0*DAWN)                                             AT 2891
   0478           Endif                                                                          AT 28b3
   0479           If (TMINT.LT.TDUSK) then                                                       AT 2902
   0480             D28 = TDUSK - TMINT + XTEMP                                                  AT 2902
   0481             D29 = ALOG(D28/XTEMP)/(2.0*DAWN)                                             AT 2902
   0482           Else                                                                           AT 293c
   0483             D30 = (TMINT - TDUSK)/(2.0*DAWN)                                             AT 2957
   0484           Endif                                                                          AT 2979
   0485   C                                                                                      AT 2979
   0486   C  CALCULATE AIR TEMPERATURE AT EACH TIME                                              AT 2979
   0487   C                                                                                      AT 2979
   0488           Do 70, I = 1,IPERD                                                             AT 2979
   0489             TIMH = I - 0.5                                                               AT 29a0
   0490             If (TIMH.GE.DAWN.AND.TIMH.LE.DUSK) then                                      AT 29c0
   0491               TAIR(I) = TMIN +                                                           AT 29f7
   0492        &      (D22*(1.0 + SIN((D23*(TIMH - DAWN)) + D24)))                               AT 29f7
   0493   c             TAIR(I)=TMAX                                                             AT 2a7e
   0494             Else If(TIMH.LT.DAWN) then                                                   AT 2a7e
   0495               If (TMIN.LT.TDUSKY) then                                                   AT 2ac6
   0496                 TAIR(I) = TMIN - XTEMP + (D25/EXP(D26*(DAWN + TIMH)))                    AT 2ac6
   0497               Else                                                                       AT 2b3f
   0498                 TAIR(I) = TDUSKY + (D27*(DAWN + TIMH))                                   AT 2b4e
   0499               Endif                                                                      AT 2b8f
   0500   c            TAIR(I)=TMIN                                                              AT 2b94
   0501   c         else                                                                         AT 2b94
   0502             Else If(TIMH.GT.DUSK) then                                                   AT 2b94
   0503               If (TMINT.LT.TDUSK) then                                                   AT 2bdc
   0504                 TAIR(I) = TMINT - XTEMP + (D28/EXP(D29*(TIMH -DUSK)))                    AT 2bdc
   0505               Else                                                                       AT 2c55
   0506                TAIR(I) = TDUSK + (D30*(TIMH - DUSK))                                     AT 2c64
   0507                TAIR(I)=TMIN                                                              AT 2cad
   0508               Endif                                                                      AT 2cd0
   0509             Endif                                                                        AT 2cd0
   0510    70     Continue                                                                       AT 2cd0
   0511                                                                                          AT 2d1c
   0512   C                                                                                      AT 2d1c
   0513   C  If DAILY WET BULB TEMPERATURES ARE NOT AVAILABLE, ASSUME                            AT 2d1c
   0514   C  MINIMUM TEMPERATURE = DEW POINT TEMPERATURE AND CALCULATE                           AT 2d1c
   0515   C  WATER VAPOR PRESSURE.  ASSUME A VALUE FOR THE PSYCHROMETRIC                         AT 2d1c
   0516   C  "CONSTANT"                                                                          AT 2d1c
   0517   C                                                                                      AT 2d1c
   0518   cdt added msw6 to if statement here                                                    AT 2d1c
   0519                                                                                          AT 2d1c
   0520           If (MSW1.NE.1.and.MSW6.eq.0) then                                              AT 2d1c
   0521             AVP = 0.61*EXP((17.27*TMIN)/(TMIN + 237.3))                                  AT 2d1c
   0522             GAMMA = 0.0645                                                               AT 2de6
   0523           Else                                                                           AT 2de6
   0524   cdt                                                                                    AT 2de6
   0525              if(MSW1.eq.1) then                                                          AT 2de6
   0526   C                                                                                      AT 2de6
   0527   C  SINCE DAILY WET BULB TEMPERATURES ARE AVAILABLE CALCULATE                           AT 2de6
   0528   C  SATURATION VAPOR PRESSURE AT THE WET BULB TEMPERATURES                              AT 2de6
   0529   C                                                                                      AT 2de6
   0530             SVPW = 0.61*EXP((17.27*TWET)/(TWET + 237.3))                                 AT 2de6
   0531   C                                                                                      AT 2de6
   0532   C  CALCULATE THE HUMIDITY RATIO, D31, LATENT HEAT OF EVAPORATION,                      AT 2de6
   0533   C  D32 AND THE PSYCHROMETRIC "CONSTANT"                                                AT 2de6
   0534   C                                                                                      AT 2de6
   0535             D31 = 0.622*(SVPW/(101.3 - SVPW))                                            AT 2de6
   0536             D32 = 2500.8 - (2.37*TWET)                                                   AT 2e44
   0537             GAMMA = 0.62*(1.006 + (1.846*D31))                                           AT 2e44
   0538        &   /((0.622 + D31)*(0.622 + D31)*D32)*101.3                                      AT 2e44
   0539   C                                                                                      AT 2ef2
   0540   C  CALCULATE ACTUAL WATER VAPOR PRESSURE                                               AT 2ef2
   0541   C                                                                                      AT 2ef2
   0542             AVP = SVPW - (GAMMA*(TDRY - TWET))                                           AT 2ef2
   0543           Endif                                                                          AT 2ef2
   0544                                                                                          AT 2ef2
   0545   CDT                                                                                    AT 2ef2
   0546               if(MSW6.eq.1) then                                                         AT 2ef2
   0547   C if relative humidity is available then calculate saturation vapor                    AT 2ef2
   0548   C pressures at Tmin and Tmax and average the two values                                AT 2ef2
   0549   C Also calculate TMean                                                                 AT 2ef2
   0550                   TMean=(TMax+TMin)/2.0                                                  AT 2ef2
   0551                   SVPW1= 0.61*EXP((17.27*TMin)/(TMin + 237.3))                           AT 2f19
   0552                   SVPW2= 0.61*EXP((17.27*TMax)/(TMax + 237.3))                           AT 2f5f
   0553                   SVPW=(SVPW1+SVPW2)/2.0                                                 AT 2fa5
   0554                                                                                          AT 2fbf
   0555                   D31 = 0.622*(SVPW/(101.3 - SVPW))                                      AT 2fbf
   0556                   D32 = 2500.8 - (2.37*TMean)                                            AT 2fe7
   0557                   GAMMA = 0.62*(1.006 + (1.846*D31))                                     AT 3016
   0558        &          /((0.622 + D31)*(0.622 + D31)*D32)*101.3                               AT 3016
   0559                   AVP= Rel_Humid*SVPW                                                    AT 3077
   0560             endif                                                                        AT 3095
   0561                                                                                          AT 3095
   0562           Endif                                                                          AT 3095
   0563   CDT                                                                                    AT 3095
   0564   C                                                                                      AT 3095
   0565   C  CALCULATE WATER STAURATION VAPOR PRESSURE AT AIR TEMPERATURE                        AT 3095
   0566   C  AND THE SLOPE OF THE RELATIONSHIP AT THAT POINT                                     AT 3095
   0567   C                                                                                      AT 3095
   0568           Do 80, I = 1,IPERD                                                             AT 3095
   0569             SVPA = 0.61*EXP((17.27*TAIR(I))/(TAIR(I) + 237.3))                           AT 30cf
   0570             DEL(I) = (0.61*EXP((17.27*(TAIR(I) + 1.))                                    AT 3133
   0571        &   /(TAIR(I) + 1.0 + 237.3))) - SVPA                                             AT 3133
   0572   C                                                                                      AT 31d8
   0573   C  CALCULATE WATER VAPOR PRESSURE DEFICIT                                              AT 31d8
   0574   C                                                                                      AT 31d8
   0575             VPD(I) = SVPA - AVP                                                          AT 31d8
   0576             If (VPD(I).LE.0.0) VPD(I) = 0.0                                              AT 320d
   0577    80     Continue                                                                       AT 3265
   0578   c....................Light interception submodel                                       AT 3299
   0579           If(NShoot.ne.0) then                                                           AT 3299
   0580   C                                                                                      AT 3299
   0581   C  CALCULATE SOLAR ALTITUDE AND SOLAR AZIMUTH FOR EACH TIME                            AT 3299
   0582   C                                                                                      AT 3299
   0583             Do 30 I = 1,IPERD                                                            AT 3299
   0584               SINALT(I) = D12 + (D13*COS(HRANG(I)))                                      AT 32c0
   0585               SOLALT(I) = ASIN(SINALT(I))                                                AT 3309
   0586               SINAZI(I) = -COS(DEC)*SIN(HRANG(I))/COS(SOLALT(I))                         AT 3329
   0587    30       Continue                                                                     AT 339e
   0588             D18 = 0.0                                                                    AT 33b9
   0589             Do 60, I = 1,IHPERD                                                          AT 33cc
   0590               SOLAZI(I) = PI + ASIN(SINAZI(I))                                           AT 3400
   0591               If (.NOT.((D18.GT.0.0).OR.(D18.LT.0.0))) then                              AT 3438
   0592                 D19 = HRANG(I) - 0.01                                                    AT 3468
   0593                 TESAZI = PI + ((ASIN(-COS(DEC)*SIN(D19))                                 AT 348d
   0594        &       /(COS(ASIN(D12 + (D13*COS(D19)))))))                                      AT 348d
   0595                 If (TESAZI.LT.SOLAZI(I)) then                                            AT 355f
   0596                   SOLAZI(I) = PI - SOLAZI(I)                                             AT 357b
   0597                 Else                                                                     AT 35a9
   0598                   D18 = 1.0                                                              AT 35a9
   0599                 Endif                                                                    AT 35bc
   0600               Endif                                                                      AT 35bc
   0601               SOLAZI(IPERD - I + 1) = TPI - SOLAZI(I)                                    AT 35bc
   0602    60       Continue                                                                     AT 35f7
   0603   C                                                                                      AT 3612
   0604   C  CALCULATE PROPORTION OF TOTAL RADIATION THAT IS DIFFUSE AT                          AT 3612
   0605   C  EACH TIME                                                                           AT 3612
   0606   C                                                                                      AT 3612
   0607             Do 40 I = 1,IPERD                                                            AT 3612
   0608               D16 = SINALT(I)                                                            AT 3640
   0609               If (D16.LT.0.01) then                                                      AT 365c
   0610                 DIFWAT(I) = 1.0                                                          AT 3679
   0611               Else                                                                       AT 36a0
   0612                 D17 = (0.93 - (0.02/D16) - ATRANS**(1/D16))                              AT 36a0
   0613        &       /(0.93 - (0.02/D16) + ATRANS**(1/D16))                                    AT 36a0
   0614                 If (CLOUD.GT.0.0) then                                                   AT 3782
   0615                   DIFWAT(I) = 1.0 - ((1.0 - D17)*(1.0 - CLOUD)                           AT 3782
   0616        &         /(1.0 - ((CLDFAC+(0.38*CLOUD))*CLOUD)))                                 AT 3782
   0617                 Else                                                                     AT 3832
   0618                   DIFWAT(I) = D17                                                        AT 3832
   0619                 Endif                                                                    AT 3855
   0620                 If (DIFWAT(I).LT.0.0) DIFWAT(I) = 0.0                                    AT 385d
   0621                 If (DIFWAT(I).GT.1.0) DIFWAT(I) = 1.0                                    AT 38c4
   0622               Endif                                                                      AT 391c
   0623   C                                                                                      AT 392b
   0624   C     *** CALCULATE PHOTOSYNTHETICALLY ACTIVE RADIATION (PAR)                          AT 392b
   0625   C         INCIDENT ON THE CROP ASSUMING THAT                                           AT 392b
   0626   C         PAR = 0.43 DIRECT + 0.57 DIFFUSE RADIATION. ***                              AT 392b
   0627   C                                                                                      AT 392b
   0628              PAR(I) = WATTSM(I)                                                          AT 392b
   0629        &          *((DIFWAT(I)*0.57) + ((1.0 - DIFWAT(I))*0.43))                         AT 392b
   0630   40         CONTINUE                                                                    AT 39bc
   0631   C                                                                                      AT 39f6
   0632   C                                                                                      AT 39f6
   0633   C  If CLOUD COVER IS COMPLETE, OMIT CALCULATIONS PERTAINING                            AT 39f6
   0634   C  TO DIRECT RADIATION INTERCEPTION                                                    AT 39f6
   0635   C                                                                                      AT 39f6
   0636             If (CLOUD.GE.1.0) then                                                       AT 39f6
   0637               Do I = 1,IPERD                                                             AT 39f6
   0638                 DIRINT(I) = 0.0                                                          AT 3a2f
   0639               Enddo                                                                      AT 3a51
   0640             Endif                                                                        AT 3a6e
   0641   C                                                                                      AT 3a6e
   0642   C  CALCULATE ANGLE BETWEEN ROW AND SOLAR AZIMUTH FOR EACH TIME                         AT 3a6e
   0643   C                                                                                      AT 3a6e
   0644             Do I = 1,IPERD                                                               AT 3a6e
   0645               SARANG(I) = ABS(SOLAZI(I) - (ROWANG*DEGRAD))                               AT 3aa0
   0646               If (SARANG(I).GT.3.*PI/2.) SARANG(I)                                       AT 3ae8
   0647        &       = ABS(SARANG(I) - TPI)                                                    AT 3ae8
   0648               If (SARANG(I).GT.PI/2.) SARANG(I)                                          AT 3b40
   0649        &       = ABS(SARANG(I) - PI)                                                     AT 3b40
   0650   C                                                                                      AT 3ba6
   0651   C  CALCULATE PROPORTION OF DIRECT RADIATION INTERCEPTED BY ROWS                        AT 3ba6
   0652   C  OF PLANTS ASSUMING THEY ARE OPAQUE CYLINDERS                                        AT 3ba6
   0653   C                                                                                      AT 3ba6
   0654               SHADOW(I) = HEIGHT/SIN(ATAN(TAN(SOLALT(I))                                 AT 3ba6
   0655        &     /SIN(SARANG(I))))                                                           AT 3ba6
   0656               DIRINT(I) = SHADOW(I)/ROWSP                                                AT 3c74
   0657               If (DIRINT(I).GT.1.0) DIRINT(I) = 1.0                                      AT 3cc8
   0658               If (DIRINT(I).LT.0.0) DIRINT(I) = 0.0                                      AT 3d2f
   0659             Enddo                                                                        AT 3d87
   0660   C                                                                                      AT 3da2
   0661   C  CALCULATE PROPORTION OF DIfFUSE RADIATION INTERCEPTED BY ROWS                       AT 3da2
   0662   C  OF PLANTS ASSUMING THEY ARE OPAQUE CYLINDERS                                        AT 3da2
   0663   C  FIRST DIVIDE ROWSPACING INTO 20 EQUAL PARTS AND FIND THE                            AT 3da2
   0664   C  MIDPOINTS FROM ROW TO MID ROW                                                       AT 3da2
   0665   C                                                                                      AT 3da2
   0666             DIfFIN = 0.0                                                                 AT 3da2
   0667             Do I = 1,10                                                                  AT 3db5
   0668               ROWINC(I) = ROWSP/20.0*(I - 0.5)                                           AT 3ddf
   0669   C                                                                                      AT 3e3d
   0670   C  CALCULATE PROPORTION OF SKY OBSCURED BY "OPAQUE" ROWS AT EACH                       AT 3e3d
   0671   C  POSITION FROM ROW TO MID-ROW                                                        AT 3e3d
   0672   C                                                                                      AT 3e3d
   0673               DIfINT(I) = (ATAN(HEIGHT/2.0/(ROWSP - ROWINC(I)))                          AT 3e3d
   0674        &     +ATAN(HEIGHT/2.0/ROWINC(I)))/1.5708                                         AT 3e3d
   0675               If (DIfINT(I).GT.1.0) DIfINT(I) = 1.0                                      AT 3f15
   0676   C                                                                                      AT 3f7c
   0677   C  INTEGRATE DIfFUSE RADIATION INTERCEPTION ACROSS THE ROW. ***                        AT 3f7c
   0678   C                                                                                      AT 3f7c
   0679               DIfFIN = DIfFIN + DIfINT(I)                                                AT 3f7c
   0680             Enddo                                                                        AT 3fa9
   0681   c                                                                                      AT 3fc1
   0682             DIfFIN = DIfFIN/10.0                                                         AT 3fc1
   0683   C                                                                                      AT 3ffe
   0684   C  CALCULATE LEAF AREA PER UNIT GROUND AREA COVERED BY CROP                            AT 3ffe
   0685   C  CANOPY                                                                              AT 3ffe
   0686   C                                                                                      AT 3ffe
   0687   C                                                                                      AT 3ffe
   0688                                                                                          AT 3ffe
   0689   C  CALCULATE AN EFFECTIVE LCAI ALLOWING FOR THE FACT THAT LIGHT                        AT 3ffe
   0690   C  AT A LOW ANGLE TRAVERSES MORE LEAF LAYERS TO REACH THE SOIL                         AT 3ffe
   0691   C                                                                                      AT 3ffe
   0692                                                                                          AT 3ffe
   0693                                                                                          AT 3ffe
   0694              LCAI=LAI                                                                    AT 3ffe
   0695                                                                                          AT 3ffe
   0696             Do 50, I = 1,IPERD                                                           AT 3ffe
   0697               If (SOLALT(I).GT.0.0) then                                                 AT 4030
   0698                 ELCAI = LCAI/(SIN(ACOS(COS(SARANG(I))                                    AT 4050
   0699        &       *COS(SOLALT(I)))))                                                        AT 4050
   0700                 If (SHADOW(I).GT.ROWSP)                                                  AT 40f9
   0701        &           ELCAI = ELCAI*SHADOW(I)/ROWSP                                         AT 40f9
   0702   C                                                                                      AT 41e6
   0703   C  CALCULATE BEERS LAW CORRECTION FOR RADIATION INTERCEPTION                           AT 41e6
   0704   C                                                                                      AT 41e6
   0705                 If((ELCAI*CEC).LE.88.0) then                                             AT 41e6
   0706                   BEERS = (1 - EXP(-ELCAI*CEC))                                          AT 41e6
   0707                 Else                                                                     AT 41e6
   0708                   BEERS=1.0                                                              AT 41e6
   0709                 Endif                                                                    AT 41f9
   0710                                                                                          AT 4208
   0711   C  CALCULATE PROPORTION OF PHOTOSYNTHETICALLY ACTIVE RADIATION                         AT 4208
   0712   C   (PAR) INTERCEPTED BY THE CROP CANOPY ASSUMING THAT                                 AT 4208
   0713   C    PAR = 0.43 DIRECT + 0.57 DIFFUSE RADIATION. ***                                   AT 4208
   0714                                                                                          AT 4208
   0715         PARINT(I) = WATTSM(I)*((DIFFIN*0.57*DIFWAT(I))                                   AT 4208
   0716        &     + (DIRINT(I)*0.43*(1.0 - DIFWAT(I))))                                       AT 4208
   0717        &     /PAR(I)*BEERS                                                               AT 4208
   0718   C                                                                                      AT 42f2
   0719   C  CALCULATE PROPORTION OF TOTAL RADIATION INTERCEPTED BY THE                          AT 42f2
   0720   C  CROP CANOPY                                                                         AT 42f2
   0721   C                                                                                      AT 42f2
   0722                 RADINT(I) = ((DIfFIN*DIfWAT(I)) + (DIRINT(I)                             AT 42f2
   0723        &         *(1.0 - DIfWAT(I))))*BEERS                                              AT 42f2
   0724               Else If (WATTSM(I).GT.0.0) then                                            AT 4385
   0725                 BEERS = (1 - EXP(-LCAI*CEC))                                             AT 4420
   0726                 PARINT(I) = COVER*BEERS                                                  AT 4420
   0727                 RADINT(I) = COVER*BEERS                                                  AT 445c
   0728               Else                                                                       AT 4498
   0729                  PARINT(I) = 0.0                                                         AT 44a7
   0730                  RADINT(I) = 0.0                                                         AT 44d1
   0731               Endif                                                                      AT 44f3
   0732    50       Continue                                                                     AT 44f3
   0733           Endif                                                                          AT 4552
   0734   C                                                                                      AT 4552
   0735   c..................End of radiation interception submodel                              AT 4552
   0736   C                                                                                      AT 4552
   0737   C                                                                                      AT 4552
   0738   c..................Daily calculations for the precipitation                            AT 4552
   0739   C                                                                                      AT 4552
   0740                                                                                          AT 4552
   0741           If(Rain.ge.0.) then                                                            AT 4552
   0742             DtRain=RAIN/IR                                                               AT 4552
   0743             Do i=24,1,-1                                                                 AT 4552
   0744               If(DtRain.ge.PERIOD) then                                                  AT 4570
   0745                 RINT(i)=IR                                                               AT 4597
   0746                 dtRain=dtRain-PERIOD                                                     AT 45ba
   0747               Else                                                                       AT 45dc
   0748   cdt changed this from dtrain/ir 11/14/96                                               AT 45eb
   0749                 RINT(i)=DtRain*IR/period                                                 AT 45eb
   0750                 goto 55                                                                  AT 4621
   0751               Endif                                                                      AT 4626
   0752             Enddo                                                                        AT 4626
   0753           Else                                                                           AT 4678
   0754             QF=QF-RAIN                                                                   AT 4678
   0755             Do i=1,NumFP                                                                 AT 4678
   0756               k=NumF(i)                                                                  AT 469f
   0757               CodeW(k)=1                                                                 AT 46cc
   0758               hNew(k)=hFur(i)                                                            AT 46f0
   0759             Enddo                                                                        AT 472a
   0760             IfUR=1                                                                       AT 4759
   0761           Endif                                                                          AT 4759
   0762   c........................End of daily calculations                                     AT 4759
   0763         Endif                                                                            AT 4759
   0764   C                                                                                      AT 4759
   0765   C     Further we have hourly calculations                                              AT 4759
   0766   C                                                                                      AT 4759
   0767   55    If(abs(time-tNext(ModNum)).lt.0.001*Step) then                                   AT 4759
   0768   c 55    If(abs(t-tAtm).gt.St) goto 1001                                                AT 47be
   0769           ITIME=int(MOD(t+St,1.)/PERIOD+1)                                               AT 47be
   0770   C                                                                                      AT 4802
   0771   C  FOR DAYLIGHT PERIODS:                                                               AT 4802
   0772   C  CALCULATE NET UPWARD LONG-WAVE RADIATION ***                                        AT 4802
   0773   C                                                                                      AT 4802
   0774   1000    Continue                                                                       AT 4802
   0775           If (WATTSM(ITIME).GT.0.0) then                                                 AT 493f
   0776             RNLU = (1.6E-3*WATRAT*(100.0 - TAIR(ITIME)))*697.6                           AT 493f
   0777           Else                                                                           AT 493f
   0778             RNLU=0.                                                                      AT 493f
   0779           ENDIf                                                                          AT 493f
   0780   C                                                                                      AT 493f
   0781   C  NO SHADE IF NO PLANT                                                                AT 493f
   0782   C                                                                                      AT 493f
   0783           If(NShoot.eq.0) then                                                           AT 493f
   0784             SHADE = 0.                                                                   AT 493f
   0785             COVER = 0.                                                                   AT 493f
   0786   c          RowSP = 1.0                                                                 AT 493f
   0787   cdt there was a problem here since it overwrites rowsp where it was                    AT 493f
   0788   c initialized in crop - need to move the above code into a crop module                 AT 493f
   0789   c even if a dummy one                                                                  AT 493f
   0790          ENDIf                                                                           AT 493f
   0791   C                                                                                      AT 493f
   0792   C  CALCULATE POTENTIAL WATER EVAPORATION RATE FROM THE SOIL                            AT 493f
   0793   C  SURFACE                                                                             AT 493f
   0794   C                                                                                      AT 493f
   0795   C  THE TOTAL RADIATION FALLING ON THE SOIL IS ASSUMED TO BE                            AT 493f
   0796   C  CONCENTRATED ON THE EXPOSED SOIL CELLS AND AN EQUIVALENT                            AT 493f
   0797   C  TOTAL RADIATION IS CALCULATED                                                       AT 493f
   0798   C                                                                                      AT 493f
   0799   cdt        If (Cover.lt.0.97) then                                                     AT 493f
   0800   C                                                                                      AT 493f
   0801             D11 = WATTSM(ITIME)                                                          AT 493f
   0802   cdt      in glycim, radint is not used for soil evaportion                             AT 493f
   0803   cdt     &   *(1.0 - RADINT(ITIME))*(1.-COVER)                                          AT 493f
   0804                                                                                          AT 493f
   0805   cdt   original above was correct                                                       AT 493f
   0806   cdt     &   *(1.0 - RADINT(ITIME))/(1.-COVER)                                          AT 493f
   0807   c                                                                                      AT 493f
   0808   cdt        Else                                                                        AT 493f
   0809   cdt         D11=0.                                                                     AT 493f
   0810   cdt        Endif                                                                       AT 493f
   0811   c                                                                                      AT 493f
   0812   c  MARCH ALONG THE SURFACE TO FIND SOIL-ATMOSPHERE BOUNDARY NODES                      AT 493f
   0813   c  AND THEIR LATERAL COORDINATES                                                       AT 493f
   0814   c                                                                                      AT 493f
   0815           ic=0                                                                           AT 493f
   0816           Do k=1,NumBP                                                                   AT 4961
   0817             i=KXB(k)                                                                     AT 498f
   0818             If(abs(CodeW(i)).eq.4) then                                                  AT 49b5
   0819               ic=ic+1                                                                    AT 49e4
   0820               xS(ic)=x(i)                                                                AT 49eb
   0821               iS(ic)=i                                                                   AT 4a25
   0822               kS(ic)=k                                                                   AT 4a35
   0823             Endif                                                                        AT 4a45
   0824           Enddo                                                                          AT 4a45
   0825           Call SORT03(ic,xS,iS,kS)                                                       AT 4a62
   0826   C                                                                                      AT 4a9d
   0827   C initialize boundary values to 0                                                      AT 4a9d
   0828            Do i=1, NumBP                                                                 AT 4a9d
   0829            do j=1, 4                                                                     AT 4ac0
   0830              if (j.lt.4) VarBW(i,j)=0.0                                                  AT 4ad0
   0831              VarBT(i,j)=0.0                                                              AT 4b37
   0832            Enddo                                                                         AT 4b6f
   0833           Enddo                                                                          AT 4b87
   0834           Do 90 i=1,ic                                                                   AT 4ba2
   0835   cDT 4-22-2011 assume 10% of et is minimum from a covered node                          AT 4bd0
   0836                                                                                          AT 4bd0
   0837             PSh=max(0.0,FSh(i,xBSTEM,SHADE,xS,ic))                                       AT 4bd0
   0838   c                                                                                      AT 4c20
   0839   c  IF THE NODE IS EXPOSED THEN                                                         AT 4c20
   0840   c                                                                                      AT 4c20
   0841             If(PSh.gt.0.) then                                                           AT 4c20
   0842   C                                                                                      AT 4c3c
   0843   C  CALCULATE THE ALBEDO OF THE EXPOSED SOIL CELLS                                      AT 4c3c
   0844   C                                                                                      AT 4c3c
   0845                 LAMDAS = 0.3 - 0.5*ThNew(iS(i))                                          AT 4c3c
   0846   C                                                                                      AT 4c82
   0847   C  CALCULATE NET RADIATION ON THE EXPOSED SOIL CELLS                                   AT 4c82
   0848   C                                                                                      AT 4c82
   0849                 RNS = ((1.0 - LAMDAS)*D11) - RNLU                                        AT 4c82
   0850                 If(RNS.LE.0.0) RNS = 0.0                                                 AT 4d35
   0851   C                                                                                      AT 4d35
   0852   C  CALCULATE POTENTIAL EVAPORATION RATE (g m-2 hr-1)FROM EXPOSED SOIL CELLS            AT 4d35
   0853   C                                                                                      AT 4d35
   0854   C note that Penman's original wind function was F(u)=0.26(1+0.54u)                     AT 4d35
   0855   C the 0.54 is a function of temperature and pressure                                   AT 4d35
   0856   C  where windspeed was in m s-1 and et mm d-1 cm-2 and e in mb                         AT 4d35
   0857   C  109.375 = 0.26 * (10000*10)/24/10 (0.26 has probably been truncated)                AT 4d35
   0858                                                                                          AT 4d35
   0859                                                                                          AT 4d35
   0860   C See eqn 5.11 of http://mepas.pnnl.gov/mepas/formulations/source_term/5_0/5_13/5_13.html AT 4d35
   0861                 D12 = max(1.0,2.0-(2.0*COVER))                                           AT 4d35
   0862                 If (D12.GE.1.0) D12 = 1.0                                                AT 4d35
   0863                 ESO = ((DEL(ITIME)/GAMMA*RNS*3600.0/(2500.8                              AT 4e4a
   0864        &     - (2.3668*TAIR(ITIME))))                                                    AT 4e4a
   0865        &     + (VPD(ITIME)*109.375*(1.0 + (0.149*WIND*D12))))                            AT 4e4a
   0866        &      /((DEL(ITIME)/GAMMA) + 1.0)                                                AT 4e4a
   0867   C                                                                                      AT 4e7b
   0868   C   PROPORTIONAL TO THE AREA EXPOSED                                                   AT 4e7b
   0869   C                                                                                      AT 4e7b
   0870                 VarBW(kS(i),2)=PSh*24.*ESO/10000.                                        AT 4e7b
   0871   c                                                                                      AT 4eb8
   0872   c  ELSE IF THE NODE IS COVERED                                                         AT 4eb8
   0873   cDT 4-22-2011 assume 10% of et is minimum from a covered node                          AT 4eb8
   0874   c                                                                                      AT 4eb8
   0875   c          Else                                                                        AT 4eb8
   0876   c            VarBW(kS(i),2)=0.                                                         AT 4eb8
   0877             Endif                                                                        AT 4eb8
   0878   c                Endif for the surface nodes                                           AT 4eb8
   0879    90     Continue                                                                       AT 4eb8
   0880   C                                                                                      AT 4fdc
   0881   C........................ End evaporation                                              AT 4fdc
   0882   C                                                                                      AT 4fdc
   0883   C........................ Transpiration                                                AT 4fdc
   0884   C                                                                                      AT 4fdc
   0885           If (NShoot.ne.0) then                                                          AT 4fdc
   0886   C                                                                                      AT 4fdc
   0887   C  CALCULATE A CROP SURFACE ROUGHNESS PARAMETER                                        AT 4fdc
   0888   C                                                                                      AT 4fdc
   0889           If (ITIME.EQ.1) then                                                           AT 4fdc
   0890              ROUGH = 1.0/(ABS((HEIGHT/ROWSP) - 0.5) + 0.5)                               AT 4fdc
   0891              If (ROUGH.LT.1.0) ROUGH = 1.0                                               AT 4fdc
   0892           Endif                                                                          AT 4fdc
   0893   C                                                                                      AT 4fdc
   0894   C   ON STILL HOT DAYS, CONVECTION CURRENTS AT CROP LEVEL ASSURE                        AT 4fdc
   0895   C   SOME AIR MOVEMENT                                                                  AT 4fdc
   0896   C                                                                                      AT 4fdc
   0897           WINDL = WIND                                                                   AT 4fdc
   0898           If (TAIR(ITIME).GT.25.0.AND.WINDL.LE.0.36) WINDL = 0.36                        AT 4fdc
   0899   C                                                                                      AT 5007
   0900   C   CALCULATE POTENTIAL TRANSPIRATION RATE FOR THE CROP                                AT 5007
   0901   C                                                                                      AT 5007
   0902   C   ASSUME A VALUE FOR THE ALBEDO OF THE CROP                                          AT 5007
   0903   C                                                                                      AT 5007
   0904           LAMDAC = 0.23                                                                  AT 5007
   0905   C                                                                                      AT 503a
   0906   C   THE TOTAL RADIATION INTERCEPTED BY THE CROP IS ASSUMED TO BE                       AT 503a
   0907   C   SPREAD UNIfORMLY OVER THE AREA COVERED BY THE CROP AND AN                          AT 503a
   0908   C   EQUIVALENT TOTAL RADIATION IS CALCULATED                                           AT 503a
   0909   C                                                                                      AT 503a
   0910   C   CODE TO ACCOUNT FOR THE CASE WHERE THE PLANT                                       AT 503a
   0911   C   HAS NOT YET EMERGED AND COVER =0                                                   AT 503a
   0912           If (COVER.le.0.) then                                                          AT 503a
   0913             WATPL=0.0                                                                    AT 503a
   0914           Else                                                                           AT 5052
   0915             WATPL = WATTSM(ITIME)*RADINT(ITIME)/COVER                                    AT 50cf
   0916           Endif                                                                          AT 50cf
   0917   C                                                                                      AT 50cf
   0918   C   CALCULATE NET RADIATION ON THE CROP                                                AT 50cf
   0919   C                                                                                      AT 50cf
   0920           RNC = ((1.0 - LAMDAC)*WATPL) - RNLU                                            AT 50cf
   0921           If (RNC.LE.0.0) RNC = 0.0                                                      AT 51f3
   0922   C                                                                                      AT 51f3
   0923   C   CALCULATE POTENTIAL TRANSPIRATION RATE FOR CROP ALLOWING FOR                       AT 51f3
   0924   C   INCOMPLETE GROUND COVER units are grams per m2 per hour                            AT 51f3
   0925   C                                                                                      AT 51f3
   0926           EPO = ((DEL(ITIME)/GAMMA*RNC*3600.0/(2500.8                                    AT 51f3
   0927        &   - (2.3668*TAIR(ITIME))))                                                      AT 51f3
   0928        &   + (VPD(ITIME)*109.375*(ROUGH +(0.149*WINDL))))                                AT 51f3
   0929        &   /((DEL(ITIME)/GAMMA) + 1.0)                                                   AT 51f3
   0930   C                                                                                      AT 526a
   0931   C   CODE ADDED TO PREVENT DIVISION BY o                                                AT 526a
   0932   C                                                                                      AT 526a
   0933           If (COVER.le.0.0.OR.EPO.LE.0.0) EPO=1.0E-4                                     AT 526a
   0934   C                                                                                      AT 5295
   0935   C     *** CALCULATE POTENTIAL TRANSPIRATION RATE FOR AN AVERAGE PLANT **               AT 5295
   0936   C                                                                                      AT 5295
   0937   cdt I took out etcorr, the ET correction factor                                        AT 5295
   0938   c  units are grams per plant per day adjusted for cover                                AT 5295
   0939           EO = 24.*EPO*cover/(poprow/rowsp*100)                                          AT 5295
   0940           If(COVER.le.0.0) then                                                          AT 5380
   0941             TPot=0.                                                                      AT 5380
   0942           Else                                                                           AT 5380
   0943             TPot=EO/COVER                                                                AT 5380
   0944           Endif                                                                          AT 5380
   0945         Endif                                                                            AT 5380
   0946   c................... End Transpiration .................................               AT 5380
   0947   c................... Precipitation and irrigation                                      AT 5380
   0948         Do i=1,NumBP                                                                     AT 5380
   0949         n=KXB(i)                                                                         AT 53af
   0950         k=CodeW(n)                                                                       AT 53d5
   0951         If(K.eq.4.or.K.eq.-4) then                                                       AT 53ef
   0952            VarBW(i,1)=RINT(ITIME)                                                        AT 541c
   0953          If(NumSol.ne.0) then                                                            AT 5493
   0954             do j=1,NumSol                                                                AT 5493
   0955   cdt was varbs(n,j)                                                                     AT 54bf
   0956             VarBS(i,j)=CPREC(j)                                                          AT 54bf
   0957             Enddo                                                                        AT 551e
   0958          Endif                                                                           AT 5548
   0959   *                                                                                      AT 5548
   0960            VarBW(i,3)=VarBW(i,2)-VarBW(i,1)                                              AT 5548
   0961            Q(n)=-Width(i)*VarBW(i,3)        ! positive if rainfall-> going into the soil AT 55ba
   0962            if (Q(n).gt.0.0) CodeW(n)=-4                                                  AT 562e
   0963   *                                                                                      AT 567f
   0964          Endif                                                                           AT 567f
   0965          Enddo                                                                           AT 567f
   0966   c................... End of the precipitation and irrigation                           AT 5711
   0967   C ............... Heat Balance is calculated here                                      AT 5711
   0968   C                                                                                      AT 5711
   0969   C                                                                                      AT 5711
   0970   CYAP                                                                                   AT 5711
   0971   CDT - added FELWR based on changes from temperature paper                              AT 5711
   0972   C FCSH is the constant for sensible heat transfer                                      AT 5711
   0973   C FELWR is the coefficient for radiant heat lost when the                              AT 5711
   0974   C soil is warmer than the air.                                                         AT 5711
   0975         FCSH=(4.0E-3+1.39E-3*Wind*max(1.0,2.0-(2.0*COVER)))                              AT 5711
   0976         FCSH=FCSH*4.1856*60.0*24.0                                                       AT 5711
   0977         FELWR=6.8E-03+9.0E-05*Tair(Itime)                                                AT 5768
   0978         FELWR=FELWR*4.1856*60.0*24.0                                                     AT 5768
   0979   CYAPEND                                                                                AT 577b
   0980   C units are changed from cal cm-2 min-1 C-1 -->J cm-2 d-1 C-1                          AT 577b
   0981         cWat=4.1856                                                                      AT 577b
   0982         TairN=Tair(Itime)                                                                AT 57d0
   0983   c    conversion factor                                                                 AT 57d0
   0984   c 8.64 = 3600 * 24 / 10,000 ; J m-2 s-1--> J cm-2 d-1                                  AT 57d0
   0985         Do i=1,NumBP                                                                     AT 57d0
   0986           n=kxb(i)                                                                       AT 57ff
   0987           k=codeT(n)                                                                     AT 5825
   0988           VarBT(i,3)=0.0                                                                 AT 5847
   0989           VarBT(i,2)=0.0                                                                 AT 5871
   0990            VARBT(i,4)=0                                                                  AT 589b
   0991           If (k.eq.-4) then                                                              AT 58bd
   0992             If(abs(x(n)-xBSTEM).ge.SHADE.or.NShoot.eq.0) then                            AT 58d9
   0993   * If evaporation                                                                       AT 5943
   0994   * calc heat flux due to latent heat of evaporation                                     AT 5943
   0995   * given evaporation at it's potential rate                                             AT 5943
   0996   * units are Joules cm-2 d-1 C-1                                                        AT 5943
   0997   * RNS*3600*24/10000 is total energy going to soil in J day-1 cm-2                      AT 5943
   0998   C           FELWR=max(0.0,(tmpr(i)-TairN)*40.6)                                        AT 5943
   0999   c           If (VarBW(i,2).ge.0.0.and.RNS.gt.0.0) then                                 AT 5943
   1000                   VarBT(i,4)=RNS*3600.0*24.0/10000.0                                     AT 5943
   1001                                                                                          AT 5987
   1002   CDT            If (VarBW(i,3).ge.0.0) then                                             AT 5987
   1003   CDT               VarBT(i,3)=VarBW(i,3)*(2500.8-2.3668*TairN)                          AT 5987
   1004   CDT            Endif                                                                   AT 5987
   1005   * calculate potential heat input due to precipitation                                  AT 5987
   1006   cdt heat input due to rain is done now for both shaded and bare together               AT 5987
   1007   * was else if                                                                          AT 5987
   1008   *             If (VarBw(i,3).lt.0.0) then                                              AT 5987
   1009   *                 VarBT(i,3)=VarBT(i,3)-VarBW(i,3)*CWat                                AT 5987
   1010   *               Endif                                                                  AT 5987
   1011   *  calculate convected heat                                                            AT 5987
   1012   cdt added FELWR from temperature paper results                                         AT 5987
   1013   cdt 11/2/2016 removed summation for varbt Now is consistent with hourly                AT 5987
   1014                    VarBT(i,3)=(FCSH+FELWR)*TAirN                                         AT 5987
   1015                    VarBT(i,2)=FCSH+FELWR                                                 AT 59c6
   1016                                                                                          AT 59f8
   1017             else                                                                         AT 59f8
   1018   *  parameters beneath the canopy                                                       AT 5a07
   1019   *  the amount of heat added to the soil                                                AT 5a07
   1020   *     is determined by air temperature.                                                AT 5a07
   1021   *  units are millcal m d-1 C-1                                                         AT 5a07
   1022                                                                                          AT 5a07
   1023                  VarBT(i,2)=((0.058+1.7e-4*TAirN)+                                       AT 5a07
   1024        &                  (0.052*EXP(.058*TAirN)))                                       AT 5a07
   1025                                                                                          AT 5a92
   1026   * Change units to Joules cm-2 d-1                                                      AT 5a92
   1027   cdt changed 3600 to 60 based on temperature paper                                      AT 5a92
   1028   cdt 11/2/2016 check to see if we need the 100.                                         AT 5a92
   1029                  VarBT(i,2)=VarBT(i,2)*4.1856/100.0*3600*24                              AT 5a92
   1030   * cdt for now use a constant 62.6 cal /sec /cm /C                                      AT 5ad8
   1031   * use 3600*4.184 as conversion                                                         AT 5ad8
   1032   * units are J cm-1 d-1 oC (thermal cond of air)                                        AT 5ad8
   1033   *               VarBT(i,2)=2.05                                                        AT 5ad8
   1034                  VarBT(i,3)=VarBT(i,2)*(TairN)                                           AT 5ad8
   1035   *  units are now J cm-2 d-1                                                            AT 5b2c
   1036                                                                                          AT 5b2c
   1037                                                                                          AT 5b2c
   1038   * end if for crop canopy                                                               AT 5b2c
   1039             Endif                                                                        AT 5b2c
   1040   * Endif in or out of canopy                                                            AT 5b2c
   1041   cdt modified statements after 'then' to add heat content of rain                       AT 5b2c
   1042   *  heat into soil with rain                                                            AT 5b2c
   1043                If(VarBW(i,3).lt.0.0) then                                                AT 5b2c
   1044                     VarBT(i,3)=VarBT(i,3)+VarBW(i,3)*cWat*TAirN                          AT 5b62
   1045                     VarBT(i,2)=VarBT(i,2)+VarBW(i,3)*cWat                                AT 5bca
   1046                  Endif                                                                   AT 5c2f
   1047          VarBT(i,1)=TAirN                                                                AT 5c2f
   1048           Endif                                                                          AT 5c52
   1049          Enddo                                                                           AT 5c52
   1050   C ...............End of heat balance                                                   AT 5c84
   1051   c................... Gas movement                                                      AT 5c84
   1052         Do i=1,NumBP                                                                     AT 5c84
   1053         n=KXB(i)                                                                         AT 5caf
   1054         k=CodeW(n)                                                                       AT 5cd5
   1055         If(K.eq.4.or.K.eq.-4) then                                                       AT 5cef
   1056           do jjj=1,NumG                                                                  AT 5d23
   1057             VarBG(i,jjj,2)=PG*Width(i)                                                   AT 5d4f
   1058             VarBG(i,jjj,3)=PG*GAIR(jjj)*Width(i)                                         AT 5db0
   1059           Enddo                                                                          AT 5e2b
   1060         Endif                                                                            AT 5e48
   1061         Enddo                                                                            AT 5e48
   1062   c................... End gas movement                                                  AT 5e88
   1063   c................... This is the end of hourly calculations                            AT 5e88
   1064         tNext(ModNum)=tNext(ModNum)+PERIOD                                               AT 5e88
   1065         EndIf                   ! hourly calcs defined by tnext                          AT 5ea5
   1066    1001  Continue                                                                        AT 5ea5
   1067   c................... Furrow irrigation                                                 AT 5ed4
   1068   c dt 4-22-2011 this needs to be put into its own block since we changed the tAtm variable AT 5ed4
   1069   c  this won't work as written                                                          AT 5ed4
D:\2DSOIL_Grape\Soil Source\SETSUR02.FOR(1066) : warning 21 - Label 1001 is declared, but not used 
   1070         If(IfUR.eq.1) then                                                               AT 5ed4
   1071           Do i=1,NumFP                                                                   AT 5ed4
   1072           k=NumF(i)                                                                      AT 5eff
   1073           QF=QF-Q(k)*Step                                                                AT 5f2d
   1074           Enddo                                                                          AT 5f7a
   1075           If(QF.lt.0.0) then                                                             AT 5fe9
   1076             QF=0.                                                                        AT 5fe9
   1077             IfUR=0                                                                       AT 5fe9
   1078             Do i=1,NumFP                                                                 AT 5fe9
   1079              k=NumF(i)                                                                   AT 601f
   1080              CodeW(k)=-4                                                                 AT 604d
   1081             Enddo                                                                        AT 6063
   1082             tAtm=tAtm-PERIOD                                                             AT 60a4
   1083             goto 1000  !hourly code would have been skipped over initially, so have to go back and do the hourly et calcs AT 60a4
   1084           Endif                                                                          AT 60a9
   1085         Endif                                                                            AT 60a9
   1086   c................... End of the furrow irrigation                                      AT 60a9
   1087         RETURN                                                                           AT 60a9
   1088   10    call errmes(im,il)                                                               AT 60ae
   1089         END                                                                              AT 48
   1090   C                                                                                      AT 0
   1091         Subroutine SORT03(N,ARR1,iARR2,iARR3)                                            AT 48
   1092         Dimension ARR1(N),iARR2(N),iARR3(N)                                              AT 48
   1093         Do j=2,N                                                                         AT c0
   1094            A1=ARR1(j)                                                                    AT f2
   1095            iA2=iARR2(j)                                                                  AT 10b
   1096            iA3=iARR3(j)                                                                  AT 120
   1097            Do i=j-1,1,-1                                                                 AT 135
   1098              if(ARR1(i).LE.A1) goto 10                                                   AT 152
   1099              ARR1(i+1)=ARR1(i)                                                           AT 178
   1100              iARR2(i+1)=iARR2(i)                                                         AT 194
   1101              iARR3(i+1)=iARR3(i)                                                         AT 1a6
   1102            Enddo                                                                         AT 1b8
   1103            i=0                                                                           AT 1d0
   1104   10       ARR1(i+1)=A1                                                                  AT 1db
   1105            iARR2(i+1)=iA2                                                                AT 1f7
   1106            iARR3(i+1)=iA3                                                                AT 20c
   1107         Enddo                                                                            AT 221
   1108         Return                                                                           AT 233
   1109         End                                                                              AT 8e
   1110   C   Shaded-unshaded                                                                    AT 0
   1111         Function FSh(i, xStem, Shade, u, N)                                              AT 8e
   1112         Dimension u(N)                                                                   AT 8e
   1113         Fsh=1.                                                                           AT b6
   1114         If(Shade.le.0.) Return                                                           AT c6
   1115         If (i.eq.1) then                                                                 AT eb
   1116           xm=u(i)                                                                        AT 104
   1117           xp=(u(1)+u(2))/2.                                                              AT 12a
   1118         Elseif(i.eq.N) then                                                              AT 14b
   1119           xm=(u(N-1)+u(N))/2.                                                            AT 171
   1120           xp=u(N)                                                                        AT 1af
   1121         Else                                                                             AT 1ca
   1122           xm=(u(i-1)+u(i))/2.                                                            AT 1ca
   1123           xp=(u(i)+u(i+1))/2.                                                            AT 208
   1124         Endif                                                                            AT 236
   1125         xL=xSTEM-Shade                                                                   AT 236
   1126         xR=xSTEM+Shade                                                                   AT 264
   1127         If(xm.le.xL) then                                                                AT 282
   1128           If(xp.lt.xL) then                                                              AT 28c
   1129             FSh=1.                                                                       AT 2a2
   1130           Elseif(xp.le.xR) then                                                          AT 2b7
   1131             FSh=(xL-xm)/(xp-xm)                                                          AT 2cd
   1132           Else                                                                           AT 2fd
   1133             FSh=1.-(xR-xL)/(xp-xm)                                                       AT 2fd
   1134           Endif                                                                          AT 33d
   1135         Else                                                                             AT 33d
   1136           If(xm.ge.xR) then                                                              AT 342
   1137             FSh=1.                                                                       AT 358
   1138           Elseif(xp.le.xR) then                                                          AT 36d
   1139             FSh=0.                                                                       AT 383
   1140           Else                                                                           AT 398
   1141             FSh=(xp-xR)/(xp-xm)                                                          AT 398
   1142           Endif                                                                          AT 3c3
   1143         Endif                                                                            AT 3c3
   1144         Return                                                                           AT 3c3
   1145         End                                                                              AT 436




End of Compilation - Clocked 0.03 seconds
